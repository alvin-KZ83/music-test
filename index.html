<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Chord Selection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            margin: 20px;
            padding: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Select Your Favorite Chord</h1>
    <p>Listen to the two chords and select your favorite:</p>
    <div>
        <button id="playChord1">Play Chord 1</button>
        <button id="playChord2">Play Chord 2</button>
    </div>
    <div>
        <button id="selectChord1">I Prefer Chord 1</button>
        <button id="selectChord2">I Prefer Chord 2</button>
    </div>
    <p id="result"></p>

    <script>
        const chordTypes = [
            "major", "minor", "diminished", "augmented", "dominant_seventh", "minor_seventh", "major_seventh"
        ];

        let testChords = [...chordTypes];
        let sample = [];

        // Create a synth using Tone.js
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();

        // MIDI note mapping for root note (C)
        const noteToMidi = { 'C': 60, 'C#': 61, 'D': 62, 'D#': 63, 'E': 64, 'F': 65, 'F#': 66, 'G': 67, 'G#': 68, 'A': 69, 'A#': 70, 'B': 71 };

        // Chord intervals for different types
        const chordIntervals = {
            "major": [0, 4, 7],
            "minor": [0, 3, 7],
            "diminished": [0, 3, 6],
            "augmented": [0, 4, 8],
            "dominant_seventh": [0, 4, 7, 10],
            "minor_seventh": [0, 3, 7, 10],
            "major_seventh": [0, 4, 7, 11]
        };

        // Function to play a chord
        function playChord(root, chordType) {
            const rootMidi = noteToMidi[root];
            const intervals = chordIntervals[chordType];
            const chordNotes = intervals.map(interval => Tone.Frequency(rootMidi + interval, "midi").toNote());
            
            // Play the chord in ascending order
            chordNotes.forEach((note, i) => {
                synth.triggerAttackRelease(note, "8n", Tone.now() + i * 0.5);
            });
            
            // Then play the full chord together
            synth.triggerAttackRelease(chordNotes, "2n", Tone.now() + chordNotes.length * 0.5);
        }

        let currentPair = [];

        // Play Chord 1
        document.getElementById('playChord1').addEventListener('click', function() {
            currentPair = testChords.splice(0, 2);
            playChord("C", currentPair[0]);
        });

        // Play Chord 2
        document.getElementById('playChord2').addEventListener('click', function() {
            playChord("C", currentPair[1]);
        });

        // Select Chord 1 as preferred
        document.getElementById('selectChord1').addEventListener('click', function() {
            sample.push(currentPair[0]);
            nextRound();
        });

        // Select Chord 2 as preferred
        document.getElementById('selectChord2').addEventListener('click', function() {
            sample.push(currentPair[1]);
            nextRound();
        });

        // Move to the next round of selection
        function nextRound() {
            if (testChords.length > 0) {
                testChords = sample.slice();
                sample = [];
                document.getElementById('result').innerText = "Next round starting...";
            } else {
                document.getElementById('result').innerText = `Congrats! Your favorite chord type is: ${sample[0]}.`;
            }
        }
    </script>
</body>
</html>
